# Niagara Module: Point Cloud Texture Loader

This document outlines a simple Niagara module script that reads the `PosTex` and `ColorTex`
textures exported by `ExportVisiblePointsLOD` and writes their contents to
`Particle.Position` and `Particle.Color`.

## Overview

`ExportVisiblePointsLOD` can optionally output two textures alongside the text
file containing point data. The textures are square (`TexDim` x `TexDim`) where
each pixel stores one point. The position texture is a 16â€‘bit HDR texture with
the world position in **meters** encoded in RGB. The color texture stores the
original point color.

The Niagara module samples both textures using the particle's `ParticleID` as an
index. The sampled values are then written to each particle.

## Custom HLSL

Create a new Niagara Module Script and add a `CustomHlsl` node with the
following code. The helper function is provided in
`Shaders/NiagaraPointTexSampler.ush`.

```hlsl
#include "NiagaraPointTexSampler.ush"

void Main(
    uint    ParticleID,
    Texture2D PosTex,
    Texture2D ColorTex,
    int TexDim,
    out float3 Position,
    out float4 Color)
{
    SamplePointTex(ParticleID, Position, Color, PosTex, ColorTex, TexDim);
}
```

### Parameters
* **PosTex** : HDR texture exported with suffix `_PosTex` (SRGB disabled).
* **ColorTex** : color texture exported with suffix `_ColorTex` (SRGB enabled).
* **TexDim** : dimension of the textures in pixels.

The function samples each pixel using `Texture.Load` so no sampler state is
required. The position is multiplied by `100` to convert from meters back to
centimeters so that `Particle.Position` matches the Unreal coordinate system.

## Usage
1. Create a Niagara System and add an emitter that uses this module in its
   initialization stage.
2. Expose `PosTex`, `ColorTex` and `TexDim` as user parameters and assign the
   textures generated by the point cloud export.
3. Ensure the emitter spawns the same number of particles as the number of
   valid pixels in the textures.
4. On spawn, the module will set `Particle.Position` and `Particle.Color` from
   the textures.
